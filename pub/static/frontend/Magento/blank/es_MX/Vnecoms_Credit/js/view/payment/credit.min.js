define(['jquery','ko','uiComponent','Magento_Checkout/js/model/quote','Vnecoms_Credit/js/action/set-credit','Vnecoms_Credit/js/action/cancel-credit','priceUtils','Vnecoms_Credit/js/model/payment/credit-messages','mage/translate','tooltip',],function($,ko,Component,quote,setCreditAction,cancelCreditAction,utils,messageContainer,$t){'use strict';var quoteData=window.checkoutConfig.quoteData;var totals=quote.getTotals();var creditAmount=ko.observable(Math.abs(quoteData.credit_amount));var baseCreditAmount=ko.observable(Math.abs(quoteData.base_credit_amount));var creditBalance=0;if(typeof(window.checkoutConfig.storeCredit)!='undefined')
creditBalance=parseFloat(window.checkoutConfig.storeCredit.balance);var isCustomerLoggedIn=window.checkoutConfig.isCustomerLoggedIn;var canUseCreditConfig=window.checkoutConfig.canUseCredit;var isApplied=ko.observable(baseCreditAmount()>0);var isLoading=ko.observable(false);return Component.extend({defaults:{template:'Vnecoms_Credit/payment/credit'},creditBalance:creditBalance,customerLoggedIn:isCustomerLoggedIn,canUseCreditConfig:canUseCreditConfig,creditAmount:creditAmount,baseCreditAmount:baseCreditAmount,isApplied:isApplied,isLoading:isLoading,isCustomerLoggedIn:function(){return this.customerLoggedIn;},canUseCredit:function(){return this.canUseCreditConfig;},getAvailableCredit:function(){return this.formatBasePrice(this.creditBalance);},getCreditBalance:function(){return this.creditBalance;},formatPrice:function(amount){var priceFormat=quote.getPriceFormat();return utils.formatPrice(amount,priceFormat);},formatBasePrice:function(amount){var basePriceFormat=quote.getBasePriceFormat();return utils.formatPrice(amount,basePriceFormat);},currentCurrencyIsBaseCurrency:function(){var basePriceFormat=quote.getBasePriceFormat();var priceFormat=quote.getPriceFormat();return basePriceFormat.pattern==priceFormat.pattern;},initTooltip:function(){$(".credit-icon").tooltip();return'';},readOnlyMode:function(readOnlyMode){var usedCreditCotnainer=$(".used-credit-container");var creditAmountContainer=$('.credit-amount-cotainer');if(readOnlyMode===true){if(usedCreditCotnainer.hasClass('_hide'))usedCreditCotnainer.removeClass('_hide');if(creditAmountContainer.hasClass('_show'))creditAmountContainer.removeClass('_show');}else{if(!usedCreditCotnainer.hasClass('_hide'))usedCreditCotnainer.addClass('_hide');if(!creditAmountContainer.hasClass('_show'))creditAmountContainer.addClass('_show');}},setEditMode:function(){this.readOnlyMode(false);},setReadOnlyMode:function(){this.readOnlyMode(true);},apply:function(){if(this.validate()){isLoading(true);setCreditAction(baseCreditAmount,creditAmount,isApplied,isLoading);this.readOnlyMode(true);}},cancel:function(){isLoading(true);creditAmount('');baseCreditAmount('');cancelCreditAction(isApplied,isLoading);this.readOnlyMode(true);},toggleUseCredit:function(){var creditContainer=$('#use-credit-container');if($("#use-store-credit").prop("checked")){if(!creditContainer.hasClass('_show'))
creditContainer.addClass('_show');}else{if(creditContainer.hasClass('_show'))
creditContainer.removeClass('_show');if(isApplied())this.cancel();}},validate:function(){var form='#credit-form';var amount=parseFloat($("#credit-amount").val());var check=(amount<=this.creditBalance);if(!check){messageContainer.addErrorMessage({'message':$t('You can\'t apply the amount which is greater than your credit balance')});}
return $(form).validation()&&$(form).validation('isValid')&&check;}});});